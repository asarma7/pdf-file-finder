<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Viewer</title>
    <style>
      html,
      body,
      iframe {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        border: 0;
      }
    </style>
  </head>
  <body>
    <iframe id="viewerFrame" title="PDF Viewer"></iframe>
    <script>
      const fileUrl = `/file/{{ collection_id }}/{{ doc_id }}`;
      const page = {{ page }};
      const term = "{{ term }}";
      const iframe = document.getElementById("viewerFrame");
      const base = `/static/pdfjs/web/viewer.html?file=${encodeURIComponent(fileUrl)}`;
      const search = term ? `&search=${encodeURIComponent(term)}` : "";
      const pdfjsUrl = `${base}#page=${page}${search}`;
      fetch("/static/pdfjs/web/viewer.html", { method: "HEAD" })
        .then((res) => {
          if (res.ok) {
            iframe.src = pdfjsUrl;
          } else {
            iframe.src = `${fileUrl}#page=${page}`;
          }
        })
        .catch(() => {
          iframe.src = `${fileUrl}#page=${page}`;
        });
    </script>
  </body>
</html>
